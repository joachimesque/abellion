name: Deploy Pull Request

on: [pull_request, workflow_dispatch]

jobs:
  deploy:
    name: 🪴 Deploy Pull Request
    runs-on: ubuntu-latest
    steps:
      - name: ⚙️ Checkout
        uses: actions/checkout@v2

      - name: 🛠 Build
        run: |
          sed -i -e '6ipaths: { base: "/branches/${{ github.event.pull_request.head.ref }}" },\' ./svelte.config.js
          sed -i 's+href="/manifest.json"+href="/branches/${{ github.event.pull_request.head.ref }}/manifest.json"+g' ./src/app.html
          npm ci
          npm run build

      - name: 📂 Sync files
        uses: SamKirkland/FTP-Deploy-Action@4.3.0
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USER }}
          password: ${{ secrets.FTP_PASSWORD }}
          local-dir: build/
          server-dir: branches/${{ github.event.pull_request.head.ref }}/
